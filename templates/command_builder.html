<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ› ï¸ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± - Ø¨ÙˆØª Highrise EDX</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
    <style>
        .command-preview {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-robot"></i> Ø¨ÙˆØª Highrise EDX
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="/">
                    <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </a>
                <a class="nav-link active" href="/command-builder">
                    <i class="fas fa-tools"></i> Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <div class="row">
            <!-- Ù†Ù…ÙˆØ°Ø¬ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
            <div class="col-12" id="passwordSection">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5><i class="fas fa-lock"></i> Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ù…ÙŠØ© - Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±</h5>
                        <small>ÙŠØªØ·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„</small>
                    </div>
                    <div class="card-body text-center">
                        <div class="row justify-content-center">
                            <div class="col-md-6">
                                <div class="alert alert-warning">
                                    <i class="fas fa-shield-alt"></i>
                                    <strong>Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ù…ÙŠØ©!</strong><br>
                                    ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                                </div>

                                <div class="form-group mb-3">
                                    <label for="builderPassword" class="form-label">
                                        <i class="fas fa-key"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:
                                    </label>
                                    <input type="password" 
                                           id="builderPassword" 
                                           class="form-control form-control-lg text-center" 
                                           placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±..." 
                                           maxlength="10">
                                </div>

                                <button id="verifyPasswordBtn" 
                                        class="btn btn-primary btn-lg w-100" 
                                        onclick="verifyPassword()">
                                    <i class="fas fa-unlock"></i> ÙØªØ­ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                                </button>

                                <div id="passwordError" class="alert alert-danger mt-3" style="display: none;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span id="passwordErrorText"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
            <div class="col-12" id="commandBuilderSection" style="display: none;">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5><i class="fas fa-hammer"></i> Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± - Ù…ÙÙØªØ­</h5>
                        <small>ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­</small>
                        <button class="btn btn-sm btn-outline-light float-end" onclick="lockCommandBuilder()">
                            <i class="fas fa-lock"></i> Ù‚ÙÙ„
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="container">
        <h1>ğŸ› ï¸ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø®ØµØµØ©</h1>

        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±! Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆØ§Ù…Ø± Ù…Ø®ØµØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¨ÙˆØª.
        </div>

        <!-- Ù…Ø±Ø¨Ø¹ ØµÙ†Ø§Ø¹Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-location-arrow"></i> ØµÙ†Ø§Ø¹Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„: ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø± -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="navigationCommand">ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø±:</label>
                            <input type="text" id="navigationCommand" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø°Ù‡Ø¨_Ù„Ù„Ù…Ø³Ø±Ø­">
                            <small class="text-muted">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø± Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª</small>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</label>
                            <div class="row">
                                <div class="col-4">
                                    <input type="number" id="navX" class="form-control" placeholder="X" step="0.1">
                                </div>
                                <div class="col-4">
                                    <input type="number" id="navY" class="form-control" placeholder="Y" step="0.1">
                                </div>
                                <div class="col-4">
                                    <input type="number" id="navZ" class="form-control" placeholder="Z" step="0.1">
                                </div>
                            </div>
                            <small class="text-muted">Ù…Ø«Ø§Ù„: X=10, Y=0, Z=5</small>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«: Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="navMessage">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea id="navMessage" class="form-control" rows="2" placeholder="Ù…Ø«Ø§Ù„: ğŸ­ ØªÙ… Ù†Ù‚Ù„Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø±Ø­ Ø¨Ù†Ø¬Ø§Ø­! (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)"></textarea>
                            <small class="text-muted">Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ÙŠÙ‚ÙˆÙ„Ù‡Ø§ Ø§Ù„Ø¨ÙˆØª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ° (Ø¥Ø°Ø§ ØªÙØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø³Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)</small>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°:</label>
                            <select id="navPermissions" class="form-control">
                                <option value="everyone">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                                <option value="vip">VIP ÙÙ‚Ø·</option>
                                <option value="moderator">Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙÙ‚Ø·</option>
                                <option value="owner">Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·</option>
                            </select>
                        </div>
                    </div>

                    <!-- Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ -->
                    <div class="col-md-6 d-flex align-items-end">
                        <button id="createNavigationCommand" class="btn btn-primary btn-block">
                            <i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù…Ø±Ø¨Ø¹ ØµÙ†Ø§Ø¹Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ§Øª -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5><i class="fas fa-music"></i> ØµÙ†Ø§Ø¹Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ§Øª</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„: ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø± -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="danceCommand">ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø±:</label>
                            <input type="text" id="danceCommand" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø±Ù‚ØµØ©_Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©">
                            <small class="text-muted">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø± Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª</small>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚ØµØ© -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="danceEmote">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚ØµØ©:</label>
                            <select id="danceEmote" class="form-control">
                                <option value="">ğŸ­ Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚ØµØ©...</option>
                                <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ§Øª Ù…Ù† Ø§Ù„Ù€ API -->
                            </select>
                            <small class="text-muted">Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚ØµØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</small>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«: Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="danceMessage">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea id="danceMessage" class="form-control" rows="2" placeholder="Ù…Ø«Ø§Ù„: ğŸ’ƒ ÙŠÙ„Ø§ Ù†Ø±Ù‚Øµ! Ø§Ø³ØªÙ…ØªØ¹! (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)"></textarea>
                            <small class="text-muted">Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ÙŠÙ‚ÙˆÙ„Ù‡Ø§ Ø§Ù„Ø¨ÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ø±Ù‚Øµ (Ø¥Ø°Ø§ ØªÙØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù…Ø² âœ¨)</small>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ù‚ØµØ© -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Ù…Ø¹Ø§ÙŠÙ†Ø©:</label>
                            <div class="alert alert-info" id="dancePreview">
                                <i class="fas fa-info-circle"></i> Ø§Ø®ØªØ± Ø±Ù‚ØµØ© Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ø³Ù…Ù‡Ø§
                            </div>
                        </div>
                    </div>

                    <!-- Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ -->
                    <div class="col-md-6 d-flex align-items-end">
                        <button id="createDanceCommand" class="btn btn-success btn-block">
                            <i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ©
                        </button>
                    </div>
                </div>
            </div>
        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-list"></i> Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h4>
                    </div>
                    <div class="card-body">
                        <div id="savedCommands">
                            <p class="text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        async function loadSavedCommands() {
            try {
                const response = await fetch('/api/custom-commands');
                const data = await response.json();

                if (data.success) {
                    // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
                    const allCommands = [];

                    // Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„
                    if (data.commands && data.commands.navigation_commands) {
                        allCommands.push(...data.commands.navigation_commands);
                    }

                    // Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ§Øª
                    if (data.commands && data.commands.dance_commands) {
                        allCommands.push(...data.commands.dance_commands);
                    }

                    displaySavedCommands({ commands: allCommands });
                } else {
                    const savedCommandsEl = document.getElementById('savedCommands');
                    if (savedCommandsEl) {
                        savedCommandsEl.innerHTML = '<p class="text-danger">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±</p>';
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±:', error);
                const savedCommandsEl = document.getElementById('savedCommands');
                if (savedCommandsEl) {
                    savedCommandsEl.innerHTML = '<p class="text-danger">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</p>';
                }
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function displaySavedCommands(data) {
            const container = document.getElementById('savedCommands');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!data || !data.commands) {
                container.innerHTML = '<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ø­ÙÙˆØ¸Ø©</p>';
                return;
            }

            const commands = data.commands;

            if (!commands || commands.length === 0) {
                container.innerHTML = '<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ø­ÙÙˆØ¸Ø©</p>';
                return;
            }

            let html = '<div class="row">';
            commands.forEach((cmd, index) => {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±
                if (cmd.coordinates) {
                    // Ø£Ù…Ø± ØªÙ†Ù‚Ù„
                    html += `
                        <div class="col-md-6 mb-3">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>ğŸ¯ ${cmd.command} (ØªÙ†Ù‚Ù„)</span>
                                        <button class="btn btn-danger btn-sm" onclick="deleteCommand(${cmd.id}, 'navigation')" title="Ø­Ø°Ù Ø§Ù„Ø£Ù…Ø±">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <p class="card-text mb-1">
                                        <strong>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> (${cmd.coordinates.x}, ${cmd.coordinates.y}, ${cmd.coordinates.z})
                                    </p>
                                    <p class="card-text mb-1">
                                        <strong>ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong> ${cmd.message}
                                    </p>
                                    <p class="card-text mb-1">
                                        <strong>ğŸ”’ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</strong> ${cmd.permissions}
                                    </p>
                                    <small class="text-muted">ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(cmd.created_at).toLocaleString('ar-EG')}</small>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (cmd.emote) {
                    // Ø£Ù…Ø± Ø±Ù‚ØµØ©
                    const isAutoRepeat = cmd.auto_repeat || cmd.is_auto_dance;
                    const cardClass = isAutoRepeat ? 'border-warning' : 'border-success';
                    const headerClass = isAutoRepeat ? 'bg-warning text-dark' : 'bg-success text-white';
                    const danceIcon = isAutoRepeat ? 'ğŸ”„' : 'ğŸ’ƒ';
                    const danceType = isAutoRepeat ? '(Ø±Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©)' : '(Ø±Ù‚ØµØ©)';

                    html += `
                        <div class="col-md-6 mb-3">
                            <div class="card ${cardClass}">
                                <div class="card-header ${headerClass}">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>${danceIcon} ${cmd.command} ${danceType}</span>
                                        <div>
                                            <button class="btn btn-danger btn-sm" onclick="deleteCommand(${cmd.id}, 'dance')" title="Ø­Ø°Ù Ø§Ù„Ø£Ù…Ø±">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                            ${!isAutoRepeat ? `<button class="btn btn-success btn-sm" onclick="makeAutoRepeatDance('${cmd.command}', '${cmd.emote}')" title="Ø¬Ø¹Ù„ Ø§Ù„Ø±Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙˆÙ…ØªÙƒØ±Ø±Ø©">
                                                <i class="fas fa-sync-alt"></i>
                                            </button>` : `<span class="badge bg-warning text-dark">ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</span>`}
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <p class="card-text mb-1">
                                        <strong>ğŸµ Ø§Ù„Ø±Ù‚ØµØ©:</strong> ${cmd.emote}
                                    </p>
                                    <p class="card-text mb-1">
                                        <strong>ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong> ${cmd.message}
                                    </p>
                                    <p class="card-text mb-1">
                                        <strong>ğŸ”’ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</strong> ${cmd.permissions}
                                    </p>
                                    ${isAutoRepeat ? '<p class="card-text mb-1"><strong>ğŸ”„ Ø§Ù„Ù†ÙˆØ¹:</strong> <span class="text-warning">Ø±Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…ØªÙƒØ±Ø±Ø©</span></p>' : ''}
                                    <small class="text-muted">ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(cmd.created_at).toLocaleString('ar-EG')}</small>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // Ø­Ø°Ù Ø£Ù…Ø± Ù…Ø®ØµØµ
        async function deleteCommand(commandId, commandType = 'navigation') {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±ØŸ')) {
                return;
            }

            try {
                const response = await fetch('/api/custom-commands/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        id: commandId,
                        type: commandType 
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ù…Ø± Ø¨Ù†Ø¬Ø§Ø­');
                    loadSavedCommands(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                } else {
                    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø£Ù…Ø±: ' + result.message);
                }
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
        function loadCustomCommands() {
            fetch('/api/custom-commands')
                .then(response => response.json())
                .then(data => {
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø®ØµØµØ©
                    console.log('Ø£ÙˆØ§Ù…Ø± Ù…Ø®ØµØµØ© Ù…Ø­Ù…Ù„Ø©:', data);
                })
                .catch(error => console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±:', error));
        }

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ù‚ØµØ§Øª
        async function loadEmotes() {
            try {
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ù‚ØµØ§Øª...');
                const response = await fetch('/api/emotes');
                const data = await response.json();

                console.log('ğŸ“¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ù‚ØµØ§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:', data);

                const danceEmoteSelect = document.getElementById('danceEmote');
                if (danceEmoteSelect) {
                    // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                    danceEmoteSelect.innerHTML = '<option value="">ğŸ­ Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚ØµØ©...</option>';

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ù‚ØµØ§Øª
                    let emotesList = [];
                    if (data.emotes_list && Array.isArray(data.emotes_list)) {
                        emotesList = data.emotes_list;
                    } else if (data.emotes && Array.isArray(data.emotes)) {
                        emotesList = data.emotes;
                    } else {
                        console.error('âŒ Ø¨Ù†ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ù‚ØµØ§Øª ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©:', data);
                        return;
                    }

                    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ù‚ØµØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                    const emoteCategories = {
                        'emote': [],
                        'dance': [],
                        'idle': [],
                        'emoji': [],
                        'other': []
                    };

                    emotesList.forEach((emote, index) => {
                        const emoteNumber = index + 1;
                        const emoteWithNumber = `${emoteNumber}. ${emote}`;

                        if (emote.startsWith('emote-')) {
                            emoteCategories.emote.push({name: emote, display: emoteWithNumber});
                        } else if (emote.startsWith('dance-')) {
                            emoteCategories.dance.push({name: emote, display: emoteWithNumber});
                        } else if (emote.startsWith('idle-')) {
                            emoteCategories.idle.push({name: emote, display: emoteWithNumber});
                        } else if (emote.startsWith('emoji-')) {
                            emoteCategories.emoji.push({name: emote, display: emoteWithNumber});
                        } else {
                            emoteCategories.other.push({name: emote, display: emoteWithNumber});
                        }
                    });

                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù‚ØµØ§Øª Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù†Ø¸Ù…Ø©
                    const categoryNames = {
                        'emote': 'ğŸ­ Ø±Ù‚ØµØ§Øª Emote',
                        'dance': 'ğŸ’ƒ Ø±Ù‚ØµØ§Øª Dance', 
                        'idle': 'ğŸ˜´ Ø±Ù‚ØµØ§Øª Idle',
                        'emoji': 'ğŸ˜€ ØªØ¹Ø¨ÙŠØ±Ø§Øª Emoji',
                        'other': 'ğŸª Ø±Ù‚ØµØ§Øª Ø£Ø®Ø±Ù‰'
                    };

                    Object.keys(emoteCategories).forEach(category => {
                        if (emoteCategories[category].length > 0) {
                            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = `${categoryNames[category]} (${emoteCategories[category].length})`;

                            emoteCategories[category].forEach(emoteData => {
                                const option = document.createElement('option');
                                option.value = emoteData.name;
                                option.textContent = emoteData.display;
                                optgroup.appendChild(option);
                            });

                            danceEmoteSelect.appendChild(optgroup);
                        }
                    });

                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${emotesList.length} Ø±Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­`);
                } else {
                    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚ØµØ© ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ§Øª:', error);
            }
        }

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ù‚ØµØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
        function previewDance() {
            const selectedEmote = document.getElementById('danceEmote').value;
            const previewDiv = document.getElementById('dancePreview');

            if (selectedEmote) {
                previewDiv.innerHTML = `<i class="fas fa-music"></i> Ø§Ù„Ø±Ù‚ØµØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: <strong>${selectedEmote}</strong>`;
                previewDiv.className = 'alert alert-success';
            } else {
                previewDiv.innerHTML = '<i class="fas fa-info-circle"></i> Ø§Ø®ØªØ± Ø±Ù‚ØµØ© Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ø³Ù…Ù‡Ø§';
                previewDiv.className = 'alert alert-info';
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØªÙ†Ù‚Ù„ Ø¬Ø¯ÙŠØ¯
        function createNavigationCommand() {
            const command = document.getElementById('navigationCommand').value.trim();
            const x = parseFloat(document.getElementById('navX').value);
            const y = parseFloat(document.getElementById('navY').value);
            const z = parseFloat(document.getElementById('navZ').value);
            const message = document.getElementById('navMessage').value.trim();
            const permissions = document.getElementById('navPermissions').value;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!command) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø±');
                return;
            }

            if (isNaN(x) || isNaN(y) || isNaN(z)) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ØµØ­ÙŠØ­Ø©');
                return;
            }

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø®Ø§Ø¯Ù…
            const commandData = {
                command: command,
                x: x,
                y: y,
                z: z,
                message: message,
                permissions: permissions
            };

            fetch('/api/custom-commands/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(commandData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:', data);
                if (data.success) {
                    alert('âœ… ' + data.message);
                    // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    document.getElementById('navigationCommand').value = '';
                    document.getElementById('navX').value = '';
                    document.getElementById('navY').value = '';
                    document.getElementById('navZ').value = '';
                    document.getElementById('navMessage').value = '';
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                    loadSavedCommands();
                } else {
                    alert('âŒ ' + (data.error || data.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
                }
            })
            .catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
            });
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø±Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯
        function createDanceCommand() {
            const commandEl = document.getElementById('danceCommand');
            const emoteEl = document.getElementById('danceEmote');
            const messageEl = document.getElementById('danceMessage');

            if (!commandEl || !emoteEl || !messageEl) {
                alert('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
                return;
            }

            const command = commandEl.value.trim();
            const emote = emoteEl.value;
            const message = messageEl.value.trim();

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!command) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù…Ø±');
                return;
            }

            if (!emote) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚ØµØ©');
                return;
            }

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø®Ø§Ø¯Ù…
            const commandData = {
                type: 'dance',
                command: command,
                emote: emote,
                message: message,
                permissions: 'everyone' // Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹
            };

            fetch('/api/custom-commands/add-dance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(commandData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­!');
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    const fieldsToReset = ['danceCommand', 'danceMessage'];
                    fieldsToReset.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.value = '';
                    });

                    const selectField = document.getElementById('danceEmote');
                    if (selectField) selectField.value = '';

                    const previewDiv = document.getElementById('dancePreview');
                    if (previewDiv) {
                        previewDiv.innerHTML = '<i class="fas fa-info-circle"></i> Ø§Ø®ØªØ± Ø±Ù‚ØµØ© Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ø³Ù…Ù‡Ø§';
                        previewDiv.className = 'alert alert-info';
                    }
                    loadCustomCommands();
                    loadSavedCommands();
                } else {
                    alert('âŒ Ø®Ø·Ø£: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ©:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…');
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ø¹Ù„ Ø§Ù„Ø±Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙˆÙ…ØªÙƒØ±Ø±Ø©
        async function makeAutoRepeatDance(commandWord, emoteName) {
            if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¬Ø¹Ù„ Ø§Ù„Ø±Ù‚ØµØ© "${commandWord}" ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙˆÙ…ØªÙƒØ±Ø±Ø©ØŸ\n\nğŸ­ Ø§Ù„Ø±Ù‚ØµØ©: ${emoteName}\n\nğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© "${commandWord}" Ø³ØªØªÙƒØ±Ø± Ø§Ù„Ø±Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…`)) {
                return;
            }

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù…Ø± Ù„ÙŠØµØ¨Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                const response = await fetch('/api/custom-commands/make-auto-repeat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        command: commandWord,
                        emote: emoteName,
                        type: 'dance'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚ØµØ© "${commandWord}" Ù„ØªØµØ¨Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙˆÙ…ØªÙƒØ±Ø±Ø©!\n\nğŸ”„ Ø§Ù„Ø¢Ù† Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© "${commandWord}" Ø³ØªØªÙƒØ±Ø± Ø§Ù„Ø±Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`);
                    loadSavedCommands(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                } else {
                    alert(`âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚ØµØ©: ${result.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚ØµØ©:', error);
                alert(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            }
        }

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.addEventListener('DOMContentLoaded', function() {
            // Ø±Ø¨Ø· Ù…ÙØªØ§Ø­ Enter ÙÙŠ Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const passwordInput = document.getElementById('builderPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyPassword();
                    }
                });
            }

            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            if (passwordInput) {
                passwordInput.focus();
            }
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        async function verifyPassword() {
            const password = document.getElementById('builderPassword').value.trim();
            const errorDiv = document.getElementById('passwordError');
            const errorText = document.getElementById('passwordErrorText');
            const verifyBtn = document.getElementById('verifyPasswordBtn');

            if (!password) {
                showPasswordError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }

            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚
            verifyBtn.disabled = true;
            verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

            try {
                const response = await fetch('/api/verify-command-builder-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                });

                const result = await response.json();

                if (result.success) {
                    // Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                    document.getElementById('passwordSection').style.display = 'none';
                    document.getElementById('commandBuilderSection').style.display = 'block';

                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    loadCustomCommands();
                    loadSavedCommands();
                    loadEmotes().then(() => {
                        setupEventListeners();
                    });
                } else {
                    showPasswordError(result.error || 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                showPasswordError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…');
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:', error);
            } finally {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = '<i class="fas fa-unlock"></i> ÙØªØ­ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±';
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function showPasswordError(message) {
            const errorDiv = document.getElementById('passwordError');
            const errorText = document.getElementById('passwordErrorText');

            errorText.textContent = message;
            errorDiv.style.display = 'block';

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Ù‚ÙÙ„ Ù…ØµÙ†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
        function lockCommandBuilder() {
            document.getElementById('commandBuilderSection').style.display = 'none';
            document.getElementById('passwordSection').style.display = 'block';
            document.getElementById('builderPassword').value = '';
        }

        // Ø¯Ø§Ù„Ø© Ù…Ù†ÙØµÙ„Ø© Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // Ø±Ø¨Ø· Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            const createBtn = document.getElementById('createNavigationCommand');
            if (createBtn) {
                createBtn.addEventListener('click', createNavigationCommand);
            } else {
                console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ù…Ø±');
            }

            // Ø±Ø¨Ø· Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„Ø±Ù‚ØµØ©
            const createDanceBtn = document.getElementById('createDanceCommand');
            if (createDanceBtn) {
                createDanceBtn.addEventListener('click', createDanceCommand);
            }

            // Ø±Ø¨Ø· ØªØºÙŠÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚ØµØ© Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            const danceEmoteSelect = document.getElementById('danceEmote');
            if (danceEmoteSelect) {
                danceEmoteSelect.addEventListener('change', previewDance);
                console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø­Ø¯Ø« Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù‚ØµØ©');
            }

            // Ø±Ø¨Ø· Ù…ÙØªØ§Ø­ Enter ÙÙŠ Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const passwordInput = document.getElementById('builderPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyPassword();
                    }
                });
            }
        }
    </script>
</body>
</html>